<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Formulas That Actually Work</title>
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #111;
            --bg-code: #0a0a0a;
            --text-primary: #e0e0e0;
            --text-secondary: #888;
            --accent-color: #40E0D0;
            --border-color: #333;
            --shadow-color: #40E0D0;
            --practice-bg: #0d1f23;
            --try-it-bg: #1a2a2e;
            --pro-tip-bg: #0d2d2d;
        }

        [data-theme="light"] {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f9f9f9;
            --bg-code: #f0f0f0;
            --text-primary: #1a1a1a;
            --text-secondary: #666;
            --accent-color: #40E0D0;
            --border-color: #d0d0d0;
            --shadow-color: #40E0D0;
            --practice-bg: #e8f8f5;
            --try-it-bg: #e0f2f1;
            --pro-tip-bg: #e8f5e9;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
            scroll-behavior: smooth;
            scroll-padding-top: 100px;
            transition: background 0.3s, color 0.3s;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 60px;
            border-bottom: 3px solid var(--accent-color);
            padding-bottom: 20px;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--bg-secondary);
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            transform: rotate(180deg) scale(1.1);
            box-shadow: 0 0 20px var(--accent-color);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: -1px;
            color: var(--accent-color);
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        .formula-section {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 4px 4px 0 var(--shadow-color);
            transition: transform 0.2s, box-shadow 0.2s, background 0.3s;
        }

        .formula-section:hover {
            transform: translateY(-2px);
            box-shadow: 6px 6px 0 var(--shadow-color);
        }

        .formula-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .formula-name {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        .difficulty {
            color: #fff;
            padding: 5px 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .difficulty.easy { background: #4CAF50; }
        .difficulty.medium { background: #FF9800; }
        .difficulty.hard { background: #f44336; }

        .formula-syntax {
            background: var(--bg-code);
            border-left: 4px solid var(--accent-color);
            padding: 15px;
            padding-right: 80px;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            overflow-x: auto;
            color: var(--accent-color);
        }

        .what-it-does {
            margin: 20px 0;
        }

        .what-it-does h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--accent-color);
        }

        .example {
            background: var(--bg-tertiary);
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #666;
        }

        .example-title {
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--accent-color);
        }

        .try-it {
            background: var(--try-it-bg);
            border: 2px solid var(--accent-color);
            padding: 20px;
            margin: 20px 0;
        }

        .try-it h4 {
            margin-bottom: 10px;
            font-size: 1rem;
            color: var(--accent-color);
        }

        .practice-area {
            background: var(--practice-bg);
            border: 2px solid var(--accent-color);
            padding: 20px;
            margin: 20px 0;
        }

        .practice-area h4 {
            margin-bottom: 15px;
            color: var(--accent-color);
        }

        .practice-input {
            width: 100%;
            padding: 12px;
            background: var(--bg-code);
            border: 2px solid var(--border-color);
            color: var(--accent-color);
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            margin-bottom: 10px;
            transition: border-color 0.3s;
        }

        .practice-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .practice-feedback {
            padding: 10px;
            margin-top: 10px;
            border-left: 4px solid #666;
            display: none;
        }

        .practice-feedback.correct {
            background: #0d2d0d;
            border-left-color: #4CAF50;
            color: #4CAF50;
            display: block;
        }

        .practice-feedback.incorrect {
            background: #2d0d0d;
            border-left-color: #f44336;
            color: #f44336;
            display: block;
        }

        [data-theme="light"] .practice-feedback.correct {
            background: #e8f5e9;
        }

        [data-theme="light"] .practice-feedback.incorrect {
            background: #ffebee;
        }

        .playground {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group label {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .input-group input {
            padding: 10px;
            border: 2px solid var(--border-color);
            font-size: 1rem;
            font-family: inherit;
            background: var(--bg-code);
            color: var(--text-primary);
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .result {
            background: var(--accent-color);
            color: #0a0a0a;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .pro-tip {
            background: var(--pro-tip-bg);
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 20px 0;
            font-style: italic;
        }

        .nav {
            position: sticky;
            top: 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 4px 4px 0 var(--shadow-color);
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) var(--bg-primary);
            transition: background 0.3s;
        }

        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .nav-header h3 {
            font-size: 1.2rem;
            color: var(--accent-color);
            margin: 0;
        }

        .nav-toggle {
            background: none;
            border: none;
            color: var(--accent-color);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            transition: transform 0.3s;
        }

        .nav-toggle:hover {
            transform: scale(1.2);
        }

        .nav-content {
            max-height: 400px;
            overflow-y: auto;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
        }

        .nav-content.collapsed {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }

        .nav-content::-webkit-scrollbar {
            width: 8px;
        }

        .nav-content::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        .nav-content::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }

        .nav ul {
            list-style: none;
        }

        .nav li {
            margin-bottom: 8px;
        }

        .nav a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav a:hover {
            color: var(--accent-color);
        }

        @media (max-width: 768px) {
            .playground {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .formula-name {
                font-size: 1.5rem;
            }

            .theme-toggle {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
        }

        .check-btn {
            background: var(--accent-color);
            color: #0a0a0a;
            border: none;
            padding: 10px 20px;
            font-weight: 700;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.1s;
        }

        .check-btn:hover {
            transform: scale(1.05);
        }

        .check-btn:active {
            transform: scale(0.95);
        }

        .copy-btn {
            background: var(--bg-secondary);
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
            padding: 5px 12px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: var(--accent-color);
            color: var(--bg-primary);
        }

        .copy-btn:active {
            transform: scale(0.95);
        }

        .copy-btn.copied {
            background: #4CAF50;
            color: #fff;
        }

        .formula-syntax-wrapper {
            position: relative;
            margin: 15px 0;
        }

        .formula-syntax-wrapper .copy-btn {
            position: absolute;
            top: 15px;
            right: 15px;
        }

        /* AI Chatbot Styles */
        .ai-chat-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--accent-color);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(64, 224, 208, 0.4);
            transition: all 0.3s;
            z-index: 1000;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-chat-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(64, 224, 208, 0.6);
        }

        .ai-chat-container {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 380px;
            max-width: calc(100vw - 60px);
            height: 500px;
            background: var(--bg-secondary);
            border: 2px solid var(--accent-color);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            z-index: 999;
            overflow: hidden;
        }

        .ai-chat-container.open {
            display: flex;
        }

        .ai-chat-header {
            background: var(--accent-color);
            color: #0a0a0a;
            padding: 15px 20px;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-chat-close {
            background: none;
            border: none;
            color: #0a0a0a;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ai-chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .ai-chat-messages::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        .ai-chat-messages::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 3px;
        }

        .ai-message {
            padding: 12px 15px;
            border-radius: 8px;
            max-width: 85%;
            word-wrap: break-word;
        }

        .ai-message.user {
            background: var(--accent-color);
            color: #0a0a0a;
            align-self: flex-end;
            margin-left: auto;
        }

        .ai-message.assistant {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            align-self: flex-start;
        }

        .ai-message.assistant code {
            background: var(--bg-code);
            padding: 2px 6px;
            border-radius: 4px;
            color: var(--accent-color);
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .ai-typing {
            padding: 12px 15px;
            border-radius: 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            max-width: 85%;
            align-self: flex-start;
        }

        .ai-typing-dots {
            display: flex;
            gap: 4px;
        }

        .ai-typing-dots span {
            width: 8px;
            height: 8px;
            background: var(--accent-color);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .ai-typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .ai-typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .ai-chat-input-container {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
        }

        .ai-chat-input {
            flex: 1;
            padding: 10px 15px;
            background: var(--bg-code);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }

        .ai-chat-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .ai-chat-send {
            background: var(--accent-color);
            color: #0a0a0a;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .ai-chat-send:hover {
            transform: scale(1.05);
        }

        .ai-chat-send:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        @media (max-width: 768px) {
            .ai-chat-button {
                width: 50px;
                height: 50px;
                bottom: 20px;
                right: 20px;
                font-size: 1.5rem;
            }

            .ai-chat-container {
                bottom: 80px;
                right: 20px;
                width: calc(100vw - 40px);
                height: 450px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle" aria-label="Toggle theme">
                ðŸŒ™
            </button>
            <h1>Excel Formulas That Actually Work</h1>
            <p class="subtitle">No fluff. No nonsense. Just formulas that get the job done. Probably.</p>
        </header>

        <div class="nav">
            <div class="nav-header" onclick="toggleNav()">
                <h3>Quick Jump</h3>
                <button class="nav-toggle" id="nav-toggle">âˆ’</button>
            </div>
            <div class="nav-content" id="nav-content">
                <ul>
                <li><a href="#sum">SUM</a></li>
                <li><a href="#average">AVERAGE</a></li>
                <li><a href="#if">IF</a></li>
                <li><a href="#switch">SWITCH</a></li>
                <li><a href="#vlookup">VLOOKUP</a></li>
                <li><a href="#xlookup">XLOOKUP</a></li>
                <li><a href="#index-match">INDEX/MATCH</a></li>
                <li><a href="#indirect">INDIRECT</a></li>
                <li><a href="#sumif">SUMIF</a></li>
                <li><a href="#sumifs">SUMIFS</a></li>
                <li><a href="#countif">COUNTIF</a></li>
                <li><a href="#countifs">COUNTIFS</a></li>
                <li><a href="#averageif">AVERAGEIF</a></li>
                <li><a href="#concatenate">CONCATENATE/CONCAT</a></li>
                <li><a href="#textjoin">TEXTJOIN</a></li>
                <li><a href="#left-right-mid">LEFT/RIGHT/MID</a></li>
                <li><a href="#trim">TRIM</a></li>
                <li><a href="#substitute">SUBSTITUTE</a></li>
                <li><a href="#today-now">TODAY/NOW</a></li>
                <li><a href="#date">DATE</a></li>
                <li><a href="#datedif">DATEDIF</a></li>
                <li><a href="#eomonth">EOMONTH</a></li>
                <li><a href="#networkdays">NETWORKDAYS</a></li>
                <li><a href="#max-min">MAX/MIN</a></li>
                <li><a href="#round">ROUND/ROUNDUP/ROUNDDOWN</a></li>
                <li><a href="#abs">ABS</a></li>
                <li><a href="#iferror">IFERROR</a></li>
                <li><a href="#isblank">ISBLANK</a></li>
                <li><a href="#counta">COUNTA</a></li>
                <li><a href="#unique">UNIQUE</a></li>
                <li><a href="#filter">FILTER</a></li>
                <li><a href="#sort">SORT</a></li>
                <li><a href="#tocol">TOCOL</a></li>
                <li><a href="#torow">TOROW</a></li>
                <li><a href="#len">LEN</a></li>
                <li><a href="#find-search">FIND/SEARCH</a></li>
                <li><a href="#upper-lower-proper">UPPER/LOWER/PROPER</a></li>
            </ul>
            </div>
        </div>

        <!-- SUM -->
        <div class="formula-section" id="sum">
            <div class="formula-header">
                <div class="formula-name">SUM</div>
                <div class="difficulty easy">EASY</div>
            </div>

            <div class="what-it-does">
                <h3>What it does</h3>
                <p>Adds numbers together. Groundbreaking stuff, really.</p>
            </div>

            <div class="formula-syntax-wrapper">
                <button class="copy-btn" onclick="copyFormula(this, '=SUM(A1:A10)')">Copy</button>
                <div class="formula-syntax">
                    =SUM(number1, number2, ...)
                    <br>or<br>
                    =SUM(A1:A10)
                </div>
            </div>

            <div class="example">
                <div class="example-title">Example: Monthly expenses</div>
                <p><strong>Your data:</strong> Rent in A1 (Â£1200), Food in A2 (Â£400), Transport in A3 (Â£150)</p>
                <p><strong>Formula:</strong> <code>=SUM(A1:A3)</code></p>
                <p><strong>Result:</strong> Â£1,750 (the amount you'll pretend surprises you)</p>
            </div>

            <div class="practice-area">
                <h4>Practice: Write the formula</h4>
                <p>Write a formula to add cells B1, B2, and B3:</p>
                <input type="text" class="practice-input" id="practice-sum" placeholder="Type your formula here...">
                <button class="check-btn" onclick="checkFormula('sum', '=SUM(B1:B3)')">Check Answer</button>
                <div class="practice-feedback" id="feedback-sum"></div>
            </div>

            <div class="try-it">
                <h4>Try it yourself</h4>
                <div class="playground">
                    <div class="input-group">
                        <label>Number 1:</label>
                        <input type="number" id="sum-num1" value="100">
                    </div>
                    <div class="input-group">
                        <label>Number 2:</label>
                        <input type="number" id="sum-num2" value="50">
                    </div>
                    <div class="input-group">
                        <label>Number 3:</label>
                        <input type="number" id="sum-num3" value="25">
                    </div>
                </div>
                <div class="result" id="sum-result">Result: 175</div>
            </div>

            <div class="pro-tip">
                <strong>Pro tip:</strong> You can SUM across multiple ranges. =SUM(A1:A10, C1:C10, E5) works perfectly. Excel doesn't judge your organizational chaos.
            </div>
        </div>

        <!-- AVERAGE -->
        <div class="formula-section" id="average">
            <div class="formula-header">
                <div class="formula-name">AVERAGE</div>
                <div class="difficulty easy">EASY</div>
            </div>

            <div class="what-it-does">
                <h3>What it does</h3>
                <p>Calculates the mean. Remember GCSE maths? This is why.</p>
            </div>

            <div class="formula-syntax-wrapper">
                <button class="copy-btn" onclick="copyFormula(this, '=AVERAGE(A1:A10)')">Copy</button>
                <div class="formula-syntax">
                    =AVERAGE(number1, number2, ...)
                    <br>or<br>
                    =AVERAGE(A1:A10)
                </div>
            </div>

            <div class="example">
                <div class="example-title">Example: Test scores</div>
                <p><strong>Your data:</strong> Test scores in A1:A5: 85, 92, 78, 88, 95</p>
                <p><strong>Formula:</strong> <code>=AVERAGE(A1:A5)</code></p>
                <p><strong>Result:</strong> 87.6 (above average, well done you)</p>
            </div>

            <div class="practice-area">
                <h4>Practice: Write the formula</h4>
                <p>Write a formula to find the average of cells C2 through C20:</p>
                <input type="text" class="practice-input" id="practice-avg" placeholder="Type your formula here...">
                <button class="check-btn" onclick="checkFormula('avg', '=AVERAGE(C2:C20)')">Check Answer</button>
                <div class="practice-feedback" id="feedback-avg"></div>
            </div>

            <div class="try-it">
                <h4>Try it yourself</h4>
                <div class="playground">
                    <div class="input-group">
                        <label>Numbers (comma-separated):</label>
                        <input type="text" id="avg-numbers" value="85, 92, 78, 88, 95" style="grid-column: 1 / -1;">
                    </div>
                </div>
                <div class="result" id="avg-result">Result: 87.6</div>
            </div>

            <div class="pro-tip">
                <strong>Pro tip:</strong> AVERAGE ignores empty cells but counts cells with 0. So your zeros will drag that average down like your motivation on a Monday.
            </div>
        </div>

        <!-- IF -->
        <div class="formula-section" id="if">
            <div class="formula-header">
                <div class="formula-name">IF</div>
                <div class="difficulty easy">EASY</div>
            </div>

            <div class="what-it-does">
                <h3>What it does</h3>
                <p>Makes decisions. Like you, but consistent.</p>
            </div>

            <div class="formula-syntax-wrapper">
                <button class="copy-btn" onclick="copyFormula(this, '=IF(A1>0, \"Yes\", \"No\")')">Copy</button>
                <div class="formula-syntax">
                    =IF(condition, value_if_true, value_if_false)
                </div>
            </div>

            <div class="example">
                <div class="example-title">Example: Pass or fail</div>
                <p><strong>Scenario:</strong> Grade is in A1. Pass if â‰¥60, fail otherwise.</p>
                <p><strong>Formula:</strong> <code>=IF(A1>=60, "Pass", "Fail")</code></p>
                <p><strong>If A1 = 75:</strong> Pass</p>
                <p><strong>If A1 = 45:</strong> Fail (there's always resits)</p>
            </div>

            <div class="practice-area">
                <h4>Practice: Write the formula</h4>
                <p>Write a formula: If A1 is greater than 100, show "High", otherwise show "Low":</p>
                <input type="text" class="practice-input" id="practice-if" placeholder="Type your formula here...">
                <button class="check-btn" onclick="checkFormulaFlexible('if', ['=IF(A1>100,\"High\",\"Low\")', '=IF(A1>100,\"HIGH\",\"LOW\")'])">Check Answer</button>
                <div class="practice-feedback" id="feedback-if"></div>
            </div>

            <div class="try-it">
                <h4>Try it yourself</h4>
                <div class="playground">
                    <div class="input-group">
                        <label>Test Score (0-100):</label>
                        <input type="number" id="if-score" value="75" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label>Passing Grade:</label>
                        <input type="number" id="if-passing" value="60" min="0" max="100">
                    </div>
                </div>
                <div class="result" id="if-result">Result: Pass</div>
            </div>

            <div class="pro-tip">
                <strong>Pro tip:</strong> You can nest IFs like Russian dolls: =IF(A1>=90, "A", IF(A1>=80, "B", IF(A1>=70, "C", "F"))). Excel handles it. Your sanity? That's your problem.
            </div>
        </div>

        <!-- SWITCH -->
        <div class="formula-section" id="switch">
            <div class="formula-header">
                <div class="formula-name">SWITCH</div>
                <div class="difficulty medium">MEDIUM</div>
            </div>

            <div class="what-it-does">
                <h3>What it does</h3>
                <p>Like IF, but for when you have more than two options and don't fancy nesting 47 IFs like a lunatic.</p>
            </div>

            <div class="formula-syntax-wrapper">
                <button class="copy-btn" onclick="copyFormula(this, '=SWITCH(A1, 1, \"One\", 2, \"Two\", 3, \"Three\")')">Copy</button>
                <div class="formula-syntax">
                    =SWITCH(expression, value1, result1, [value2, result2], ..., [default])
                </div>
            </div>

            <div class="example">
                <div class="example-title">Example: Day of the week</div>
                <p><strong>Day number in A1:</strong> 1-7 (where 1 = Monday, because we're civilised)</p>
                <p><strong>Formula:</strong> <code>=SWITCH(A1, 1, "Monday", 2, "Tuesday", 3, "Wednesday", 4, "Thursday", 5, "Friday", 6, "Saturday", 7, "Sunday", "Invalid")</code></p>
                <p><strong>If A1 = 5:</strong> Friday (the good one)</p>
                <p><strong>If A1 = 1:</strong> Monday (the bad one)</p>
            </div>

            <div class="practice-area">
                <h4>Practice: Write the formula</h4>
                <p>Write a SWITCH formula: If A1 is "S", return "Small", if "M" return "Medium", if "L" return "Large":</p>
                <input type="text" class="practice-input" id="practice-switch" placeholder="Type your formula here...">
                <button class="check-btn" onclick="checkFormulaFlexible('switch', ['=SWITCH(A1,\"S\",\"Small\",\"M\",\"Medium\",\"L\",\"Large\")', '=SWITCH(A1,\"s\",\"Small\",\"m\",\"Medium\",\"l\",\"Large\")'])">Check Answer</button>
                <div class="practice-feedback" id="feedback-switch"></div>
            </div>

            <div class="pro-tip">
                <strong>Pro tip:</strong> SWITCH is cleaner than nested IFs and easier to read. Your future self will thank you when you revisit this spreadsheet at 3am next Tuesday.
            </div>
        </div>

        <!-- VLOOKUP -->
        <div class="formula-section" id="vlookup">
            <div class="formula-header">
                <div class="formula-name">VLOOKUP</div>
                <div class="difficulty medium">MEDIUM</div>
            </div>

            <div class="what-it-does">
                <h3>What it does</h3>
                <p>Finds something in the first column of a table, then returns a value from another column. Like ctrl+F, but with more steps and more ways to break.</p>
            </div>

            <div class="formula-syntax-wrapper">
                <button class="copy-btn" onclick="copyFormula(this, '=VLOOKUP(A1, A1:B10, 2, FALSE)')">Copy</button>
                <div class="formula-syntax">
                    =VLOOKUP(lookup_value, table_array, col_index_num, [range_lookup])
                </div>
            </div>

            <div class="example">
                <div class="example-title">Example: Product prices</div>
                <p><strong>Table in A1:B5:</strong></p>
                <p>A1: Apple | B1: Â£1.50</p>
                <p>A2: Banana | B2: Â£0.80</p>
                <p>A3: Orange | B3: Â£1.20</p>
                <p><strong>Formula:</strong> <code>=VLOOKUP("Banana", A1:B5, 2, FALSE)</code></p>
                <p><strong>Result:</strong> Â£0.80</p>
            </div>

            <div class="practice-area">
                <h4>Practice: Write the formula</h4>
                <p>Write a VLOOKUP to find "Cat" in A1:B10 and return the value from column 2 (exact match):</p>
                <input type="text" class="practice-input" id="practice-vlookup" placeholder="Type your formula here...">
                <button class="check-btn" onclick="checkFormulaFlexible('vlookup', ['=VLOOKUP(\"Cat\",A1:B10,2,FALSE)', '=VLOOKUP(\"Cat\",A1:B10,2,0)'])">Check Answer</button>
                <div class="practice-feedback" id="feedback-vlookup"></div>
            </div>

            <div class="pro-tip">
                <strong>Pro tip:</strong> FALSE means "exact match". TRUE means "close enough". Unless you're doing invoicing, in which case "close enough" gets you sacked.
            </div>

            <div class="pro-tip" style="background: #2d1a0d; border-left-color: #FF9800;">
                <strong>Common mistake:</strong> VLOOKUP can only look to the RIGHT. If what you want is to the left, you need INDEX/MATCH. Or XLOOKUP if you're posh.
            </div>
        </div>

        <!-- XLOOKUP -->
        <div class="formula-section" id="xlookup">
            <div class="formula-header">
                <div class="formula-name">XLOOKUP</div>
                <div class="difficulty medium">MEDIUM</div>
            </div>

            <div class="what-it-does">
                <h3>What it does</h3>
                <p>The modern replacement for VLOOKUP. Can search any direction and doesn't require a degree in Excel archaeology. Only works in Excel 365/2021+, so if you're still on 2007, unlucky.</p>
            </div>

            <div class="formula-syntax-wrapper">
                <button class="copy-btn" onclick="copyFormula(this, '=XLOOKUP(A1, A:A, B:B, \"Not Found\")')">Copy</button>
                <div class="formula-syntax">
                    =XLOOKUP(lookup_value, lookup_array, return_array, [if_not_found])
                </div>
            </div>

            <div class="example">
                <div class="example-title">Example: Employee lookup</div>
                <p><strong>Employee IDs in A2:A10, Salaries in C2:C10</strong></p>
                <p><strong>Formula:</strong> <code>=XLOOKUP(E2, A2:A10, C2:C10, "Not Found")</code></p>
                <p><strong>Translation:</strong> Find value in E2, return salary from column C. If employee doesn't exist, show "Not Found" (probably left for better pay)</p>
            </div>

            <div class="practice-area">
                <h4>Practice: Write the formula</h4>
                <p>Write an XLOOKUP to find the value in D1, search in A:A, return from B:B, show "Missing" if not found:</p>
                <input type="text" class="practice-input" id="practice-xlookup" placeholder="Type your formula here...">
                <button class="check-btn" onclick="checkFormulaFlexible('xlookup', ['=XLOOKUP(D1,A:A,B:B,\"Missing\")', '=XLOOKUP(D1,A:A,B:B,\"MISSING\")'])">Check Answer</button>
                <div class="practice-feedback" id="feedback-xlookup"></div>
            </div>

            <div class="pro-tip">
                <strong>Pro tip:</strong> Unlike VLOOKUP, XLOOKUP can look left, right, up, down, diagonally... basically everywhere except directly at the cause of your problems.
            </div>
        </div>

        <!-- INDEX/MATCH -->
        <div class="formula-section" id="index-match">
            <div class="formula-header">
                <div class="formula-name">INDEX/MATCH</div>
                <div class="difficulty hard">HARD</div>
            </div>

            <div class="what-it-does">
                <h3>What it does</h3>
                <p>The power combo for people who want to feel superior to VLOOKUP users. INDEX returns a value from a position. MATCH finds that position. Together, they're more flexible than a yoga instructor.</p>
            </div>

            <div class="formula-syntax-wrapper">
                <button class="copy-btn" onclick="copyFormula(this, '=INDEX(B:B, MATCH(A1, A:A, 0))')">Copy</button>
                <div class="formula-syntax">
                    =INDEX(return_range, MATCH(lookup_value, lookup_range, 0))
                </div>
            </div>

            <div class="example">
                <div class="example-title">Example: Product lookup</div>
                <p><strong>Products in A2:A10, Prices in C2:C10</strong></p>
                <p><strong>Formula:</strong> <code>=INDEX(C2:C10, MATCH("Apple", A2:A10, 0))</code></p>
                <p><strong>Translation:</strong> Find where "Apple" appears (MATCH), then return that position from prices (INDEX)</p>
            </div>

            <div class="practice-area">
                <h4>Practice: Write the formula</h4>
                <p>Write an INDEX/MATCH to find "London" in column A and return the corresponding value from column D:</p>
                <input type="text" class="practice-input" id="practice-indexmatch" placeholder="Type your formula here...">
                <button class="check-btn" onclick="checkFormulaFlexible('indexmatch', ['=INDEX(D:D,MATCH(\"London\",A:A,0))', '=INDEX(D:D,MATCH(\"LONDON\",A:A,0))'])">Check Answer</button>
                <div class="practice-feedback" id="feedback-indexmatch"></div>
            </div>

            <div class="pro-tip">
                <strong>Pro tip:</strong> INDEX/MATCH can look left (VLOOKUP can't), won't break if you insert columns (VLOOKUP will), and makes you look clever in meetings.
            </div>
        </div>

        <!-- INDIRECT -->
        <div class="formula-section" id="indirect">
            <div class="formula-header">
                <div class="formula-name">INDIRECT</div>
                <div class="difficulty hard">HARD</div>
            </div>

            <div class="what-it-does">
                <h3>What it does</h3>
                <p>Turns text into a cell reference. Sounds pointless until you need it, then it's brilliant. Like insurance, but for spreadsheets.</p>
            </div>

            <div class="formula-syntax-wrapper">
                <button class="copy-btn" onclick="copyFormula(this, '=INDIRECT(\"A1\")')">Copy</button>
                <div class="formula-syntax">
                    =INDIRECT(ref_text, [a1])
                </div>
            </div>

            <div class="example">
                <div class="example-title">Example: Dynamic sheet reference</div>
                <p><strong>Sheet name in A1:</strong> "Sales"</p>
                <p><strong>Cell reference in B1:</strong> "B5"</p>
                <p><strong>Formula:</strong> <code>=INDIRECT(A1&"!"&B1)</code></p>
                <p><strong>Result:</strong> Returns the value from cell B5 in the Sales sheet</p>
                <p><strong>Why this matters:</strong> You can now change the sheet name in A1 and the formula adapts. Magic.</p>
            </div>

            <div class="example">
                <div class="example-title">Example: Dynamic column reference</div>
                <p><strong>Column letter in A1:</strong> "C"</p>
                <p><strong>Formula:</strong> <code>=SUM(INDIRECT(A1&"1:"&A1&"10"))</code></p>
                <p><strong>Result:</strong> Sums C1:C10. Change A1 to "D" and it sums D1:D10 instead.</p>
            </div>

            <div class="practice-area">
                <h4>Practice: Write the formula</h4>
                <p>Write an INDIRECT formula to reference cell B10 using the text "B10":</p>
                <input type="text" class="practice-input" id="practice-indirect" placeholder="Type your formula here...">
                <button class="check-btn" onclick="checkFormulaFlexible('indirect', ['=INDIRECT(\"B10\")', '=INDIRECT(\"b10\")'])">Check Answer</button>
                <div class="practice-feedback" id="feedback-indirect"></div>
            </div>

            <div class="pro-tip">
                <strong>Pro tip:</strong> INDIRECT is brilliant for dynamic dashboards. Warning: it's volatile, so it recalculates constantly. Use sparingly or your spreadsheet will run like it's on dial-up.
            </div>
        </div>

        <!-- TOCOL -->
        <div class="formula-section" id="tocol">
            <div class="formula-header">
                <div class="formula-name">TOCOL</div>
                <div class="difficulty medium">MEDIUM</div>
            </div>

            <div class="what-it-does">
                <h3>What it does</h3>
                <p>Converts a range into a single column. Useful when your data is spread sideways like butter on toast and you need it vertical. Excel 365 only.</p>
            </div>

            <div class="formula-syntax-wrapper">
                <button class="copy-btn" onclick="copyFormula(this, '=TOCOL(A1:C10)')">Copy</button>
                <div class="formula-syntax">
                    =TOCOL(array, [ignore], [scan_by_column])
                </div>
            </div>

            <div class="example">
                <div class="example-title">Example: Flatten a table</div>
                <p><strong>Data in A1:C3:</strong></p>
                <p>1  2  3</p>
                <p>4  5  6</p>
                <p>7  8  9</p>
                <p><strong>Formula:</strong> <code>=TOCOL(A1:C3)</code></p>
                <p><strong>Result:</strong> Single column: 1, 2, 3, 4, 5, 6, 7, 8, 9 (reading left to right, top to bottom)</p>
            </div>

            <div class="practice-area">
                <h4>Practice: Write the formula</h4>
                <p>Write a TOCOL formula to convert the range A1:D5 into a single column:</p>
                <input type="text" class="practice-input" id="practice-tocol" placeholder="Type your formula here...">
                <button class="check-btn" onclick="checkFormula('tocol', '=TOCOL(A1:D5)')">Check Answer</button>
                <div class="practice-feedback" id="feedback-tocol"></div>
            </div>

            <div class="pro-tip">
                <strong>Pro tip:</strong> Set ignore parameter to 1 to skip blanks, 2 to skip errors, 3 to skip both. Because sometimes your data is messier than your desk.
            </div>
        </div>

        <!-- TOROW -->
        <div class="formula-section" id="torow">
            <div class="formula-header">
                <div class="formula-name">TOROW</div>
                <div class="difficulty medium">MEDIUM</div>
            </div>

            <div class="what-it-does">
                <h3>What it does</h3>
                <p>Like TOCOL, but horizontal. Converts a range into a single row. Excel 365 only.</p>
            </div>

            <div class="formula-syntax-wrapper">
                <button class="copy-btn" onclick="copyFormula(this, '=TOROW(A1:A10)')">Copy</button>
                <div class="formula-syntax">
                    =TOROW(array, [ignore], [scan_by_column])
                </div>
            </div>

            <div class="example">
                <div class="example-title">Example: Flatten vertically to horizontal</div>
                <p><strong>Data in A1:A5:</strong> Apple, Banana, Orange, Grape, Kiwi</p>
                <p><strong>Formula:</strong> <code>=TOROW(A1:A5)</code></p>
                <p><strong>Result:</strong> Single row: Apple | Banana | Orange | Grape | Kiwi</p>
                <p><strong>Use case:</strong> Making column data fit across the top of a report because your boss prefers it that way for reasons unknown to science.</p>
            </div>

            <div class="practice-area">
                <h4>Practice: Write the formula</h4>
                <p>Write a TOROW formula to convert the range B1:B20 into a single row:</p>
                <input type="text" class="practice-input" id="practice-torow" placeholder="Type your formula here...">
                <button class="check-btn" onclick="checkFormula('torow', '=TOROW(B1:B20)')">Check Answer</button>
                <div class="practice-feedback" id="feedback-torow"></div>
            </div>

            <div class="pro-tip">
                <strong>Pro tip:</strong> Combine with FILTER or SORT for dynamic horizontal lists. Warning: extremely satisfying when it works first time.
            </div>
        </div>

        <!-- SUMIF -->
        <div class="formula-section" id="sumif">
            <div class="formula-header">
                <div class="formula-name">SUMIF</div>
                <div class="difficulty medium">MEDIUM</div>
            </div>

            <div class="what-it-does">
                <h3>What it does</h3>
                <p>Adds up numbers, but only the ones that meet your criteria. Like SUM with standards.</p>
            </div>

            <div class="formula-syntax-wrapper">
                <button class="copy-btn" onclick="copyFormula(this, '=SUMIF(A:A, \"criteria\", B:B)')">Copy</button>
                <div class="formula-syntax">
                    =SUMIF(range, criteria, [sum_range])
                </div>
            </div>

            <div class="example">
                <div class="example-title">Example: Expenses by category</div>
                <p><strong>Category in A1:A5:</strong> Food, Transport, Food, Entertainment, Food</p>
                <p><strong>Amount in B1:B5:</strong> Â£50, Â£30, Â£60, Â£40, Â£45</p>
                <p><strong>Formula:</strong> <code>=SUMIF(A1:A5, "Food", B1:B5)</code></p>
                <p><strong>Result:</strong> Â£155 (that's a lot of takeaways)</p>
            </div>

            <div class="practice-area">
                <h4>Practice: Write the formula</h4>
                <p>Write a SUMIF to sum values in C:C where A:A equals "Complete":</p>
                <input type="text" class="practice-input" id="practice-sumif" placeholder="Type your formula here...">
                <button class="check-btn" onclick="checkFormulaFlexible('sumif', ['=SUMIF(A:A,\"Complete\",C:C)', '=SUMIF(A:A,\"COMPLETE\",C:C)'])">Check Answer</button>
                <div class="practice-feedback" id="feedback-sumif"></div>
            </div>

            <div class="pro-tip">
                <strong>Pro tip:</strong> You can use wildcards. =SUMIF(A1:A10, "Food*", B1:B10) catches "Food", "Food-Groceries", "Food-Regret", etc.
            </div>
        </div>

    </div>

    <!-- AI Chat Assistant -->
    <button class="ai-chat-button" onclick="toggleChat()" id="ai-chat-button" aria-label="Ask AI Assistant">
        ðŸ¤–
    </button>

    <div class="ai-chat-container" id="ai-chat-container">
        <div class="ai-chat-header">
            <span>Excel Formula Assistant</span>
            <button class="ai-chat-close" onclick="toggleChat()">Ã—</button>
        </div>
        <div class="ai-chat-messages" id="ai-chat-messages">
            <div class="ai-message assistant">
                ðŸ‘‹ Hi! I'm your Excel formula helper. Ask me anything:
                <br><br>
                â€¢ "How do I add up cells that meet a condition?"<br>
                â€¢ "Why isn't my VLOOKUP working?"<br>
                â€¢ "What's the difference between SUMIF and SUMIFS?"<br>
                â€¢ "Help me build a formula for..."
            </div>
        </div>
        <div class="ai-chat-input-container">
            <input 
                type="text" 
                class="ai-chat-input" 
                id="ai-chat-input" 
                placeholder="Ask about Excel formulas..."
                onkeypress="handleChatKeypress(event)"
            >
            <button class="ai-chat-send" onclick="sendMessage()" id="ai-chat-send">Send</button>
        </div>
    </div>

    <script>
        // Theme toggle
        function toggleTheme() {
            const html = document.documentElement;
            const themeToggle = document.getElementById('theme-toggle');
            const currentTheme = html.getAttribute('data-theme');
            
            if (currentTheme === 'light') {
                html.removeAttribute('data-theme');
                themeToggle.textContent = 'ðŸŒ™';
                localStorage.setItem('theme', 'dark');
            } else {
                html.setAttribute('data-theme', 'light');
                themeToggle.textContent = 'â˜€ï¸';
                localStorage.setItem('theme', 'light');
            }
        }

        // Load saved theme on page load
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            const themeToggle = document.getElementById('theme-toggle');
            
            if (savedTheme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
                themeToggle.textContent = 'â˜€ï¸';
            } else {
                themeToggle.textContent = 'ðŸŒ™';
            }
        });

        // Toggle navigation
        function toggleNav() {
            const navContent = document.getElementById('nav-content');
            const navToggle = document.getElementById('nav-toggle');
            
            if (navContent.classList.contains('collapsed')) {
                navContent.classList.remove('collapsed');
                navToggle.textContent = 'âˆ’';
            } else {
                navContent.classList.add('collapsed');
                navToggle.textContent = '+';
            }
        }

        // Copy formula to clipboard
        function copyFormula(button, formula) {
            navigator.clipboard.writeText(formula).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                button.textContent = 'Failed';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            });
        }

        // Practice formula checker
        function normalizeFormula(formula) {
            return formula.toUpperCase().replace(/\s/g, '');
        }

        function checkFormula(id, correctAnswer) {
            const input = document.getElementById(`practice-${id}`);
            const feedback = document.getElementById(`feedback-${id}`);
            const userAnswer = input.value.trim();
            
            if (!userAnswer) {
                feedback.className = 'practice-feedback incorrect';
                feedback.textContent = 'Please enter a formula first. We\'re not mind readers.';
                return;
            }

            if (normalizeFormula(userAnswer) === normalizeFormula(correctAnswer)) {
                feedback.className = 'practice-feedback correct';
                feedback.textContent = 'âœ“ Correct! You absolute legend.';
            } else {
                feedback.className = 'practice-feedback incorrect';
                feedback.textContent = `âœ— Not quite. Expected: ${correctAnswer}. Keep trying, you'll get there.`;
            }
        }

        function checkFormulaFlexible(id, correctAnswers) {
            const input = document.getElementById(`practice-${id}`);
            const feedback = document.getElementById(`feedback-${id}`);
            const userAnswer = input.value.trim();
            
            if (!userAnswer) {
                feedback.className = 'practice-feedback incorrect';
                feedback.textContent = 'Please enter a formula first. We\'re patient, but not infinite.';
                return;
            }

            const normalized = normalizeFormula(userAnswer);
            const isCorrect = correctAnswers.some(answer => normalizeFormula(answer) === normalized);

            if (isCorrect) {
                feedback.className = 'practice-feedback correct';
                feedback.textContent = 'âœ“ Brilliant! You\'ve nailed it.';
            } else {
                feedback.className = 'practice-feedback incorrect';
                feedback.textContent = `âœ— Close, but no cigar. Try: ${correctAnswers[0]}`;
            }
        }

        // Interactive calculators
        function updateSum() {
            const num1 = parseFloat(document.getElementById('sum-num1').value) || 0;
            const num2 = parseFloat(document.getElementById('sum-num2').value) || 0;
            const num3 = parseFloat(document.getElementById('sum-num3').value) || 0;
            const result = num1 + num2 + num3;
            document.getElementById('sum-result').textContent = `Result: ${result}`;
        }

        document.getElementById('sum-num1').addEventListener('input', updateSum);
        document.getElementById('sum-num2').addEventListener('input', updateSum);
        document.getElementById('sum-num3').addEventListener('input', updateSum);

        function updateAverage() {
            const numbersStr = document.getElementById('avg-numbers').value;
            const numbers = numbersStr.split(',').map(n => parseFloat(n.trim())).filter(n => !isNaN(n));
            const result = numbers.length > 0 ? (numbers.reduce((sum, n) => sum + n, 0) / numbers.length).toFixed(2) : 0;
            document.getElementById('avg-result').textContent = `Result: ${result}`;
        }

        document.getElementById('avg-numbers').addEventListener('input', updateAverage);

        function updateIf() {
            const score = parseFloat(document.getElementById('if-score').value) || 0;
            const passing = parseFloat(document.getElementById('if-passing').value) || 60;
            const result = score >= passing ? 'Pass' : 'Fail';
            document.getElementById('if-result').textContent = `Result: ${result}`;
        }

        document.getElementById('if-score').addEventListener('input', updateIf);
        document.getElementById('if-passing').addEventListener('input', updateIf);

        // AI Chat Functions
        function toggleChat() {
            const chatContainer = document.getElementById('ai-chat-container');
            chatContainer.classList.toggle('open');
            
            if (chatContainer.classList.contains('open')) {
                document.getElementById('ai-chat-input').focus();
            }
        }

        function handleChatKeypress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('ai-chat-input');
            const messagesContainer = document.getElementById('ai-chat-messages');
            const sendButton = document.getElementById('ai-chat-send');
            const message = input.value.trim();

            if (!message) return;

            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'ai-message user';
            userMessage.textContent = message;
            messagesContainer.appendChild(userMessage);

            // Clear input and disable send button
            input.value = '';
            sendButton.disabled = true;

            // Show typing indicator
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'ai-typing';
            typingIndicator.innerHTML = '<div class="ai-typing-dots"><span></span><span></span><span></span></div>';
            messagesContainer.appendChild(typingIndicator);

            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            try {
                // Call Claude API
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1024,
                        messages: [
                            {
                                role: 'user',
                                content: `You are an Excel formula expert helping someone learn formulas. Be concise, friendly, and use a bit of dry British humor. When showing formulas, wrap them in backticks like \`=SUM(A1:A10)\`. Keep responses under 150 words unless explaining a complex formula.

User question: ${message}`
                            }
                        ]
                    })
                });

                const data = await response.json();

                // Remove typing indicator
                messagesContainer.removeChild(typingIndicator);

                // Add assistant response
                const assistantMessage = document.createElement('div');
                assistantMessage.className = 'ai-message assistant';
                
                // Get the text response and format code blocks
                const responseText = data.content
                    .filter(block => block.type === 'text')
                    .map(block => block.text)
                    .join('\n');
                
                // Convert backtick code to <code> tags
                const formattedText = responseText.replace(/`([^`]+)`/g, '<code>$1</code>');
                assistantMessage.innerHTML = formattedText;
                
                messagesContainer.appendChild(assistantMessage);

            } catch (error) {
                console.error('Chat error:', error);
                
                // Remove typing indicator
                messagesContainer.removeChild(typingIndicator);
                
                // Show error message
                const errorMessage = document.createElement('div');
                errorMessage.className = 'ai-message assistant';
                errorMessage.textContent = "Sorry, I'm having trouble connecting right now. Try again in a moment?";
                messagesContainer.appendChild(errorMessage);
            }

            // Re-enable send button and scroll
            sendButton.disabled = false;
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
    </script>
</body>
</html>
<!-- Last updated Feb 2025 -->